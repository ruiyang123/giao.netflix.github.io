<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* width */
::-webkit-scrollbar {
  width: 20px;
}

/* Track */
::-webkit-scrollbar-track {
  box-shadow: inset 0 0 5px grey; 
  border-radius: 10px;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
  background: red; 
  border-radius: 10px;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: #b30000; 
}
</style>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.js"></script>

</head>

<body>
  <script>
  var margin = {top: 20, right: 30, bottom: 30, left: 40},
      width = 960 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;
      var xScale = d3.scaleLinear()
        .domain([-width / 2, width / 2])
        .range([0, width]);
   
    
   	var a = d3.rgb(255,255,255);
    var b = d3.rgb(200,0,0);
    var compute = d3.interpolate(a,b);
    var linear = d3.scaleLinear().domain([0,2000]).range([0,1]);
    
    
   var view = null,
   currentTransform = null;
    var yScale = d3.scaleLinear()
        .domain([-height / 2, height / 2])
        .range([height, 0]);
    var color = d3.scaleOrdinal(d3.schemeCategory20);
   var svg = d3.select("body")
   .append("svg")
   .attr("width",width)
   .attr("height",height);
    view = svg.append("g")
        .attr("class", "view");
    if (currentTransform) view.attr('transform', currentTransform);

   
 
    
   
    var projection = d3.geoEqualEarth().rotate([-10, 0]);

    var path = d3.geoPath() // d3.geo.path avec d3 version 3
                 .projection(projection);
    d3.json("https://raw.githubusercontent.com/ruiyang123/giao.netflix.github.io/master/data_country.json",function(data){
      
      
    d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json",function(error,world){
      
     // console.log(world.objects.countries.geometries)   
      
     //console.log(world.objects.countries.geometries);
      
      for ( var i in world.objects.countries.geometries){
        
        //console.log(world.objects.countries.geometries[i].properties);
        
        world.objects.countries.geometries[i].properties["nomb"] = -1;
       // console.log(world.objects.countries.geometries[i].properties)
      };
      
      for (var i=0;i<data.length;i++){
        var country = data[i].country;
        var tol_nom = data[i].value;
        
        for (var j in world.objects.countries.geometries){
          
          if( world.objects.countries.geometries[j].properties.name== country){
            world.objects.countries.geometries[j].properties["nomb"] = tol_nom
            
            
          }
        }
        
      }
      
      
	    svg.selectAll("path")
           .data(topojson.feature(world, world.objects.countries).features)
           .enter()
           .append("path")
           .attr("d", path)
      				.attr("class","carte")
      				.attr("fill",function(d,i){
        //console.log(d.properties.nomb)
        //console.log(d.properties.name)
        if(d.properties.nomb == -1){return d3.rgb(120,120,120)}
        else{return compute(linear(d.properties.nomb))}
      })
    .on("mouseover",function(){tooltip.style("display",null);})
    .on("mouseout",function(){tooltip.style("display","none");})
    .on("mousemove",function(d){
        console.log(d3.mouse(this))
          var xPosition = d3.mouse(this)[0];
        	var  yPosition = d3.mouse(this)[1];
        tooltip.attr("transform","translate("+ xPosition +","+ yPosition +")");
        tooltip.select("text").text(
        function(){
          if (d.properties.nomb == -1) {
            return d.properties.name + ":" + 0
            
          }
          else{return d.properties.name + ":" + d.properties.nomb}
        }
        )
          
          
    				 })
      
      
      
        var tooltip = svg.append("g")
    .attr("class","tooltip")
    .style("display","none");
    
    tooltip.append("rect")
    .attr("width",100)
    .attr("height",20)
    .attr("fill","white")
    .style("opacity",0.5)
    .style("rect-anchor","middle");
    
    tooltip.append("text")
    .attr("x",15)
    .attr("dy","1.2em")
    .style("text-anchor","right")
    .attr("font-size","12px")
    .attr("font-weight","bold");
      
      
    });
    
    
    })
    
    
    
    
    
    
    // zoom and pan
   var zoom = d3.zoom()
    .scaleExtent([0.5, 5])
    .translateExtent([
        [-width * 2, -height * 2],
        [width * 2, height * 2]
    ])
    .on("zoom", zoomed);
      
   function zoomed() {
    currentTransform = d3.event.transform;
     console.log(currentTransform)
    svg.selectAll(".carte").attr("transform", currentTransform);
     //svg.selectAll(".tooltip").attr("transform", currentTransform);
}
  svg.call(zoom);
    
    

var margin = {top:50, right:15,bottom:30,left:40},
    width = 580 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

var y = d3.scaleLinear()
          .rangeRound([height,0])
.nice();
    
var x = d3.scaleBand()
          .rangeRound([0,width])
.paddingInner(0.05)
.align(0.1)

var z = d3.scaleOrdinal(d3.schemeCategory20)

var parseTime = d3.timeParse("%Y")
  d3.json('https://raw.githubusercontent.com/ruiyang123/giao.netflix.github.io/master/data2.json', function(error, raw) {   
    var symbols = []
    
    for (var key in raw[0]){
      if (key!="year"){
        symbols.push(key)
        
      }
    }
    
  //console.log(symbols)
    
    var years = raw.map(function(d){return d.year;})

    
    var layers = d3.stack().keys(symbols)(raw)
    
    var max = d3.max(layers[layers.length - 1],function(d){return d[1];});
    
    y.domain([0,max]);
    x.domain(years);
    
    var svg = d3.select("body").append("svg")
                .attr("width",width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate("+ margin.left +","+ margin.top +")")
                ;
    //console.log(layers[2].key)
    svg.append("g").selectAll("g")
        .data(layers)
    .enter().append("g")
    .style("fill",function(d){return z(d.key);})
    .attr("class",function(d){return d.key})
    .attr("id","stack")
    .on("mouseover",function(d){
      
      svg.selectAll("#stack").filter(function(e){
      
     // console.log(e.key)
      //console.log(d.key)
      return e.key!==d.key;
    }).style("opacity",.3);
      
      svg.selectAll("#leg").filter(function(e){
        console.log(e)
        console.log(z(d.key))
        return e!==z(d.key)
      }).style("opacity",.3)
                               
       })
    .on("mouseout",function(d){
      svg.selectAll("#stack").style("opacity",1);
      svg.selectAll("#leg").style("opacity",1);
                              
                              })
    //.on("mouseover",function(d){ svg.selectAll("."+d.key).style("opacity",1)})
    
    .selectAll("rect")
    .data(function(d){return d;})
    .enter().append("rect")
    .attr("x",function(d,i){return x(d.data.year)})
    .attr("y", function(d){return y(d[1])})
    .attr("height",function(d){return y(d[0])-y(d[1])})
    .attr("width",x.bandwidth())
    .on("mouseover",function(){tooltip.style("display",null);})
    .on("mouseout",function(){tooltip.style("display","none");})
    .on("mousemove",function(d){
      var xPosition = d3.mouse(this)[0]-15;
      var yPosition = d3.mouse(this)[1] - 25;
      tooltip.attr("transform","translate("+ xPosition +", "+ yPosition +")");
      tooltip.select("text").text(d[1]-d[0])
    })
    
    ;
    
    var colors = symbols.map(function(d){return z(d)});
    //console.log(colors)
    
    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x))
    
    svg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + (0) + ", 0)")
      .call(d3.axisLeft().scale(y))
  // console.log(layers)
    
    var legend = svg.selectAll(".legend")
    .data(colors)
    .enter().append("g")
    .attr("class","legend")
    .attr("transform",function(d,i){return "translate(30, "+ i*10 +")"})
    
    legend.append("rect")
    .attr("id","leg")
    .attr("x",18)
    .attr("width",9)
    .attr("height",9)
    .style("fill",function(d,i){return z(symbols[i]);})
    
    legend.append("text")
    .attr("x",36)
    .attr("y",9)
    .attr("dy",".15em")
    .style("text-anchor",'start')
    .attr("font-size",10)
    .text(function(d,i){ return symbols[i]})
    
    var tooltip = svg.append("g")
    .attr("class","tooltip")
    .style("display","none");
    
    tooltip.append("rect")
    .attr("width",30)
    .attr("height",20)
    .attr("fill","white")
    .style("opacity",.5);
    
    tooltip.append("text")
    .attr("x",15)
    .attr("dy","1.2em")
    .style("text-anchor","middle")
    .attr("font-size","12px")
    .attr("font-weight","bold");

    svg.append("text")
    .attr("x",200)
    .attr("y",20)
    .attr("dy","2em")
    .style("text-anchor","middle")
    .attr("font-size","10px")
    .attr("font-weight","bold")
    .text("Rating and Quantity in different year")
    
    
    
    
  })

  </script>
  <div id="menu" style="background-color:#FFD700;height:200px;width:200px;float:right;">
<b>Guide Bar</b>
<br/>
<a href="index.html"> Rating and Quantity</a>
<br/>
<a href="group_bar.html">Movies and Tv quantity</a>
<br/>
<a href="geo_map.html">Geo Map Netflix</a>
</div>
</body>
